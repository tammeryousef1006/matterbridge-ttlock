/**
 * @license
 * Copyright 2022-2025 Matter.js Authors
 * SPDX-License-Identifier: Apache-2.0
 */
import { UnexpectedDataError } from "../MatterError.js";
import { Bytes } from "../util/Bytes.js";
import { isObject } from "../util/Type.js";
const JSON_SPECIAL_KEY_TYPE = "__object__";
const JSON_SPECIAL_KEY_VALUE = "__value__";
function toJson(object, spaces) {
  return JSON.stringify(
    object,
    (_key, value) => {
      if (value === void 0) {
        return `{"${JSON_SPECIAL_KEY_TYPE}":"Undefined"}`;
      }
      if (typeof value === "bigint") {
        return `{"${JSON_SPECIAL_KEY_TYPE}":"BigInt","${JSON_SPECIAL_KEY_VALUE}":"${value.toString()}"}`;
      }
      if (value instanceof Uint8Array) {
        return `{"${JSON_SPECIAL_KEY_TYPE}":"Uint8Array","${JSON_SPECIAL_KEY_VALUE}":"${Bytes.toHex(value)}"}`;
      }
      if (isObject(value) && value.type === "Buffer" && Array.isArray(value.data)) {
        return `{"${JSON_SPECIAL_KEY_TYPE}":"Uint8Array","${JSON_SPECIAL_KEY_VALUE}":"${Bytes.toHex(
          Uint8Array.from(value.data)
        )}"}`;
      }
      if (value instanceof Map) {
        return `{"${JSON_SPECIAL_KEY_TYPE}":"Map","${JSON_SPECIAL_KEY_VALUE}":${JSON.stringify(
          toJson(Array.from(value.entries()))
        )}}`;
      }
      return value;
    },
    spaces
  );
}
function fromJson(json) {
  return JSON.parse(json, (_key, value) => {
    if (typeof value === "string" && value.startsWith(`{"${JSON_SPECIAL_KEY_TYPE}":"`) && value.endsWith("}")) {
      const data = JSON.parse(value);
      const object = data[JSON_SPECIAL_KEY_TYPE];
      switch (object) {
        case "Undefined":
          return void 0;
        case "BigInt":
          return BigInt(data[JSON_SPECIAL_KEY_VALUE]);
        case "Uint8Array":
          return Bytes.fromHex(data[JSON_SPECIAL_KEY_VALUE]);
        case "Map":
          return new Map(
            fromJson(data[JSON_SPECIAL_KEY_VALUE])
          );
        // TODO Remove in the future, leave here for now for backward compatibility?
        case "AttributeId":
        case "CaseAuthenticatedTag":
        case "ClusterId":
        case "CommandId":
        case "DataVersion":
        case "DeviceTypeId":
        case "EndpointNumber":
        case "EntryIndex":
        case "EventId":
        case "FabricIndex":
        case "FieldId":
        case "GroupId":
        case "VendorId":
          return data[JSON_SPECIAL_KEY_VALUE];
        case "EventNumber":
        case "FabricId":
        case "NodeId":
          return BigInt(data[JSON_SPECIAL_KEY_VALUE]);
        default:
          throw new UnexpectedDataError(`Unknown object type: ${object}`);
      }
    }
    return value;
  });
}
export {
  fromJson,
  toJson
};
//# sourceMappingURL=StringifyTools.js.map
